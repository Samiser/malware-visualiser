import React from 'react'
import ReactDOM from 'react-dom'




// generate a html list of hosts from the raw data
const Hosts = ({ hosts }) => {

	return (
		<React.Fragment>
			<h1>Hosts</h1>
			<ul>
			{hosts.map((host) => (
				<li>{host.parent_ip} infected {host.ip}</li>
			))}
			</ul>
		</React.Fragment>
	)
};

class HostList extends React.Component {
	constructor(props) {
		super(props);
		this.state = {
			hosts: [],
			seconds: 0
		}
	}

	getHosts() {
		fetch('http://127.0.0.1:8000/api/worms/?format=json')
		.then(res => res.json())
		.then((data) => {
			this.setState({ hosts: data })
		})
		.catch(console.log)
	}

	componentDidMount() {
		this.getHosts();
		this.interval = setInterval(() => this.getHosts(), 1000);
	}

	componentWillUnmount() {
		clearInterval(this.interval);
	}

	render() {
		return (
			<Hosts hosts={this.state.hosts} />
		);
	}
}

const element = <HostList />;
ReactDOM.render(
  element,
  document.getElementById('react')
);
